+ параметры командной строки
		-dumpthm  - процесс загрузки thm файлов
		-dumpfsv - переменные файловой системы
		-dumpscr" - процесс загрузки скриптов
		-dumpmtr - процесс загрузки материалов
		-dumptl - процесс загрузки текстур
		-dumpslp - процесс загрузки скриптов
		-dumpsrl - процесс загрузки spawn registry
		-dumpcsr - процесс регистрации скриптовых классов]
		-dumpaor - процесс регистрации объектов в алайф
		-dumpml - процесс загрузки карт
		-dumpmle - ошибки при загрузке карт
		-dumpfs - данные о файловой системе
		-slt - показывать в логах временные отсечки

+ добавлена функция IsOPEngine() для  скриптов для проверки совместимости 
	в _g.script необходимо добавить 
	newEngine = IsOPEngine~=nil and type(IsOPEngine)=="function" and IsOPEngine()
	и дальше, там где необходимо обеспечить совместимость 
	if (newEngine) then
		--новый движок
	else
		--старый движок
	end
	
~ исправлена база материалов
~ исправлены некоторые thm файлы
~ исправлена база шейдеров
~ исправлен script_register.lua
~ gamedata ~ исправлены некоторые амк парсеры нетпакетов, миграция на m_netpk
+ R_ASSERT дубликатов секций
~ разделение длинных строк в stringtable
+ GetEngineVersion() - показывает версию движка , для вызова из скриптов
+ Вывод в сообщение об ошибке specified story id is already in story registry проблемного номера story_id
~ мусор в логе на обработке серверных событий
+ кеширование логов (по примеру RvP/alpet)
+ проверки в звуковых классах
+ изменения в экспорте iterate_inventory, release
+ убрано создание дампа памяти при креше, перенос на отдельный DEFINE
+ переименование файла логох
+ изменения в сборе traceback
+ изменения в сборе lua_traceback
+ контроль работы с нетпакетами с lua_traceback (теперь можно увидеть, какой срипт вылез за размер нетпакета)
+ object_by_id - может принимать значение nil , возвращая при этом nil


1. Разрешить стрельбу на классе бинокля.
2. Включить смерть от первого лица. Вернее, выключить переключение на третий вид при смерти гг.
Эти правки есть в xrgame 2.0. Сравни их с оригиналом 1.006 - там поправлены 2 байта. Надо это сразу бы в движке поправить) 
 

5. Если таск имеет время выполнения, то при его выполнении таск не переводить в другой раздел ПДА а просто удалять
 
Что нужно изменить вообще:
6. Пофиксить рандомный непоказ СМС на широкоформатном экране.
7. Разрешить стрельбу ОЧЕРЕДЯМИ и обвесы на классе бинокля. Точнее спроси у Димы, что есть, а что еще надо.
8. Грузить визуалы не при лоаде или спавне, а при изменении parent на 65535. То есть при спавне в инвентарь визуал не грузим вообще. А также на лоаде контролируем парент. И учесть что у неписей best_weapon должен иметь подгруженный визуал, они его держат в руках. Либо также подгружать его при необходимости. Это существенно ускорит загрузку игры,особенно где много объектов. Сейчас грузятся все визуалы независимо от парента.
9. Чтение ини: сделать просто возврат строки кастомдаты, если нет файла, и сделать её чтение end ... end по аналоги  с алспауном, в таком же формате. Это позволит убрать все кастомдаты из нескольких тысяч отдельных файлов в конфиги. Станет гораздо удобнее) Перенос я сделаю сам. Вернее скрипт забабахаем, который это сделает)

11. В билдах выла возможность вызвать функцию при формировании текста. Тэг Script_text. Она была в билдах а потом ее убрали. Её надо обязательно вернуть. Тогда описание стволов артом патронов и прочего примет единый формат и сократиться в 4 раза ибо большую часть(свойства, ттх и другое) будет генериться на лету из данных конфига. Дополнение: параметром передать онлайновый объект, к которому она вызывается. Сорт, скрипт текст был для диалогов. Но там он ни к чему а вот в в тег description он очень бы пригодился) для генерации описания предмета. Есть такая возможность это сделать? Например делаем его отдельным кеу script_description. И при получении описания зовём его при наличии и параметр - объект. Или его секция. Неважно, лишь бы к конфига доступ получить для вычитки) давай не так: чтобы максимально сохранить совместимость и минимизировать правки, давай сделаем так: функцию будем прописывать в текст. Вот есть пример вставки клавиш: $$action_use$$. При выводе подставляется значение клавиши. Давай сделаем аналогично. Например вот так:
##akill.text##
и вызывается эта функция. Параметр - онлайновый объект. Тогда в текст можно будет несколько таких вставок сделать - вполне универсально и удобно)
Этот вариант бери за основу пока. Там видно будет)

12. Статьи в пда, а также диалоги не удаляются при лоаде. Только перезапуск игры. И копится мусор в памяти. Пофиксить бы это)
13. Может что ещё не удаляется при лоаде...
14. При открытии вкладок пда указанные в справочнике на амк и в info_portions поршни не выдаются корректно так, как написано. Тоже это пофиксить бы)
15. Сделать калбек на выстрел движковый. Это будет лучше всего. Полетела пуля - калбек. Только для гг 
16. Хит калбек актору сделать. Аналогично при получении любого хита. Думаю пригодится для анимаций разных и статистики. параметры аналогично хиту сталкера.
17. Экпортировать будешь функции для отображения иконок вместо текста в новых рюкзаках?
18. если неправильный закрывающий тэг в хмл, то движок вылетает просто с фразой error reading end tag, но имя файла, в котором это - не указывается. Надо бы в лог ошибки добавить вывод имени файла.
18. Вылет по invalid vertex for object (глянь шапку вылетов на форуме) - это из-за чего? Можно как-то его пофиксить? Например, подставляя какой вертекс? 
19. Аналогочно для путей any vertex in patrol path "объект_1" in inaccessible for object "объект_2/ Здесь можно что сделать?
20. there is no specified level in the game graph - и это глянь тоже плиз)
21. Нужно пофиксить рандомный невывод СМС на широкоформатных разрешениях. Глюк движковый.
22. Провал артефактов и предметов под текстуры. Пофиксить можно? Или это из-за косяков локи?
23. Возьми В РУКИ Выхлоп, подойди ВПЛОТНУЮ к неписю и ВЫБРОСИ ствол. Он окажется не на земле, а в инвентаре непися (!) Это НУЖНО пофиксить тоже)
24. При скриптовом спавне с присвоением стори ид стори ид не прописывается сразу в регистре. Нужно сделать СЛ. Пофиксить бы.
25. Можно ли заменить чтение 
description = enc_dimak_book
inv_name = "Блокнот Димака"
inv_name_short = "Блокнот Димака"
на r_string_wq? Чтобы возвращалось значение без кавычек? Либо изменить чтение так, чтобы пробелы читались тоже. Лучше первый вариант, чтобы ничего не править.
26. При наличии в рюкзаке большого количества разных предметов II_DOC падает ФПС. Акилл больше знает об этом, с картами Кузнецова такое. Пришлось им класс на II_ATTCH сменить. С другими классами  такого нет - только II_DOC. Пофиксить бы.
27. Если сделать СЛ рядом с контриком, когда он поет своей аурой, то пение не сбрасывается, пока не выйдешь из игры. Тоже бы пофиксить)
28. Да, и по звукам. Надо бы в перспективе получить список всех звуков с кривым заголовком и перегнать нормально через СДК. Кому перегонять - есть, список только нужен) Можно будет написать в движке небольшой скриптик, который бы перебрал ВСЕ звуки из CLocatorAPI на открытие и проверку заголовка с выводом в лог кривых. Разовая такая утилитка) И все)
29. шейдеры на каллиматоры
30. Добавь в класс get_console() функцию log, которая просто выводит в лог текст без какой-либо обработки, со всеми пробелами и т.д. Как в load сообщение что не найден сейв. Чтобы по людски было, а не через костыли)
31. Вот смотри: имею такой лог:

Scheduler tried to update object krot_afterparty212900

Завис здесь происходит при обработке grenade_rgd5_fake, у которой я по ошибке сменил класс. А вот можно как-то добавить в лог еще и на каком объекте сломалось?) Пусть не везде, но может хот где-то?) Сейчас занисаюсь чисткой конфигов оружия и ловлю подобные уникальные вылеты) И раньше ловил подобное. просто дополнительная информация в логе очень сильно облегчит жизнь)
32. Еще имел вот такой вылет:

sv reject. id_parent [11926][krot_afterparty2:krot_afterparty211926] id_entity [14690][gl_test_shell_ammo_vog-25p:gl_test_shell_ammo_vog-25p14690] [21441]

ahtung !!! [21442]

CInventory::DropItem pIItem->m_pCurrentInventory!=this

this = [11926]

stack trace:

 

0023:0587476C xrGame.dll

 

Вот можно в CInventory::DropItem pIItem->m_pCurrentInventory!=this добавить секцию и ид объекта?

33. Для ситуаций выше общая задача: Можно ли поиском собрать все сообщения об ошибке в движке и там, где НЕТ параметров в тексте - ДОБАВИТЬ ИХ, насколько возможно? Секция и ид объекта будет самое то. Что выше - частный случай. По инвентраю вылеты прочти все без объектов, только ссыль на функцию. Вернее тут даже не вылет а просто крэш. Лога нет внятного. Можно тут что-нибудь сделать?)

34. Есть такой вылет: can't find rank for... Это когда в mp_ranks не прописан ствол непися. Движок как-то путает мультиплеер с синглом. Дима больше об этом расскажет. Убрать бы эту проверку и выкинуть mp_ranks совсем)

35. Когда я чистил конфиги мультиплеера, не удалось отключить 

#include "mp\weapons_mp\ammo_mp.ltx"

#include "mp\weapons_mp\weapons_mp.ltx"

#include "mp\mp_ranks.ltx"

про последний я тебе сказал, из первых двух иногда брались секции. Они там с приставкой "mp_". Были рандомные вылеты can't find section. Тоже выкинуть бы это все за ненадобностью если возможно)
36. Я к чему: может при спавне арта прописать в движок некое фиксированное увеличение позиции Y? Чтобы арт спавнился гарантированно над землей и просто опускался на jump_height? Почему счваренный арт проваливается иногда под землю на уклонах? А на ровной прверхности - практически нет? Посмотри что тут можно сделать)
35: Еще такой момент: А можно продублировать чтение из конфигов всех тех парметров, какие при спавне вычитывает движок из алспауна. Чтобы я мог в конфиге написать:

 

[agr_stalker_regular]:stalker

character_profile = agr_stalker_general

spec_rank = experienced

community = stalker

story_id = 12345

direction = 0.916156470775604,0,0.400820851325989

name = xalyava_naem1

upd:health = 3

...

Это решило бы многие проблемы при спавне. Просто ВСЕ ТЕ ЖЕ что и из алспауна. Может, как-то эту функцию можно вызвать для скриптового спавна вместо той, что сейчас есть?

36. Класс WP_RG6. Самый глючный из всех. Главная проблема, что можно сделать выстрел их пустого ствола. Зарядов не осталось, но продолжая нажимать на "Огонь"  идет звук и картинка когда грена взрывается. Но самой анимации вылета грены нет. Пофикси хотя бы это. И можешь спросить у Димы, что тут еще надо. Может, включить ему возможность стрелять очередями?)) должен прикольный ствол получиться при таком варианте) Спроси у Димы, что тут можно по мелочи сделать.
38. Еще в движке сделай string.trim, ltrim, rtrim для удаления пробелов.
38. Если отсутствует ил ошибка в ЛЮБОЙ функции, которая вызывается  ЛЮБЫМИ тегами диалогов - то вылет без лога. Надо бы сделать тут нормальный вылет с сообщением об ошибке. Аналогично глянь и для поршней, тасков и прочего, где вызывается скрипт по строке.
37. По защитам, которую дают объекты объектов: вот смотри как они задаются:
Для артов:
hit_absorbation_sect = af_dummy_spring_absorbation
[af_dummy_spring_absorbation]
burn_immunity = 1.0
strike_immunity = 0.9
shock_immunity = 1.0
wound_immunity = 1.0
radiation_immunity = 1.0
telepatic_immunity = 1.0
chemical_burn_immunity = 1.0
explosion_immunity = 1.0
fire_wound_immunity  = 1.0
 
по остальному:
immunities_sect = sect_fire_outfit_immunities
[sect_fire_outfit_immunities]
burn_immunity = 0.04
strike_immunity      = 0.01
shock_immunity = 0.01
wound_immunity = 0.01
radiation_immunity = 0.00
telepatic_immunity = 0.00
chemical_burn_immunity      = 0.02
explosion_immunity = 0.01
fire_wound_immunity = 0.015
 
То есть просто написать в конфиге объекта:
burn_immunity = 0.04
- нельзя. не работает. обязательно надо городить секцию.
 
Более того, для outfit защита, которую он дает владельцу, задается в самом конфиге:
burn_protection = 0.35
strike_protection      = 0.40
shock_protection = 0.35
wound_protection = 0.45
radiation_protection = 0.15
telepatic_protection = 0.0
chemical_burn_protection = 0.3
explosion_protection = 0.45
fire_wound_protection   = 0.50
 
А вот иммунитеты - только через секцию
 
Можно ли сделать двойное чтение. То есть читаем иммунитеты напрямую из секции. если они не заданы - то читаем из 
immunities_sect или hit_absorbation_sect  и крешимся как обычно, если их нет. Это ОЧЕНЬ сильно сократило бы конфиги. ибо там 70% одного и того же. А по большинству объектов они просто заглушены через identity_immunities. Как дойдешь сюда, напиши, тут еще посовещаться нужно будет, как лучше. Может вообще от секции отказаться, оставить ТОЛЬКО из конфига.
39. Формула расчета защиты гг броником, написанная в описании ОП-2, не работает. Какой бы костюм гг не надел, защиты для него нет никакой. Починить бы это. В ОГСЕ и лост альфа это исправлено.
Плюс у уник костюмов как лечебный берилл, восстанавливающий здоровье, не работают эти параметры.
40. У артов не работают некоторые свойства. Тот же параметр, который ты писал закомментен, сытости от артов.
41. Возможность сделать подсветку ячейки патронов, соответ оружию (те патроны, которые это оружие использует) при наведении курсора на это оружие. Как в ЗП сделано.
39. дополнение. 
Вот я бы это наоборот НЕ ПРАВИЛ. ВООБЩЕ НЕ ТРОГАЛ БЫ. Иначе поплывет весь боевой баланс, который мы так долго настраивали. Народ привык уже, все отлажено, думаю не нужно это. А остальное - да, было бы неплохо.
42. Вылет there is no specified level in the game graph. Он происходит, когда движок почему-то получает level_id, который отстутствует в графе игры, id в game_levels.ltx. Например, бывают значения 143, 98, 106 и т.д. Вот откуда они такие берутся? Можешь глянуть? Вылет происходит, когда заспавненные СКРИПТОМ, без логики монстры и неписи идут к своим работам через ползоны. Как они доберутся, - вылеты проходят. Вылет обычно, когда этот монстр переходит в онлайн рядом с гг. Если обойти это место, где вылетает - то вылета не будет.
43. В окне торговли, схронов из ТЧ чтоб лифт прокрутки не сбрасывался наверх, а оставался в том положении, в которое поставил игрок.
44. Не помню, писал раньше или нет. В ОП-2 xrgame поправлен правкой skyloader на смерть от первого лица. Чтобы при смерти камера не переключалась в 3-е лицо. И постпроцессы соответственно настроены в sk_actor_death.script. Надо это поправить в новом движке.
45. Твои правки автопаузы не работают на старом двжике. Глухой завис без лога. Вернул старый вариант. Пометь себе, разобраться потом. И я еще раз предлагаю отказаться от варварства под названием inj и НОРМАЛЬНО прописать все функции в калбеки, как это должно быть.
46. Думал я, думал и решал) давай вот эту проверку
47.И пожелалка - сделать для дист атаки возможность прописывать в конфиг бюрера hit_type_2  = тут выбираем тип урона по гг. Это я хотел бы для разнообразных типов монстров, как огненные, электрические и прочие монстры.

У класса ножа, например, две типа атаки прописаны в конфиг.

hit_type     = wound

hit_type_2 = wound

  if se_obj then

    alife():release(se_obj, true)

  end
47. Предлагаю на перспективу сделать вот что, что еще ЗНАЧИТЕЛЬНО уменьшит объем конфигов:

[mushroom]:II_FOOD

inv_name         = "Мухомор"

inv_name_short         = "Мухомор"

description = "Мухомор. Съедобен, слегка радиоактивен."

 

description

вычитывать "если есть". И по дефолту, есть нет, подставлять соответственно:

mushroom

mushroom_s

mushroom_d

то есть читаемую секцию с суффиксами. Тогда все эти теги можно просто выкинуть или не использовать, называя нужными именами string_id.

 

48. inv_name_short это строка, которая показывается на худе в углу, сокращенное name. Это вообще нужно только для патронов, ножей, болта и гранаты. Поэтому его заменить на чтение если есть, можно уже сейчас. По дефолту возвращай пустую строку.

 

49.  inv_name_short не работает для гранат. Не показывается на худе. Надо бы пофиксить.

 

50.Сделать дубль для


inv_grid_width     = 1

inv_grid_height    = 1

inv_grid_x         = 41

inv_grid_y         = 11

вот такой:

icon = x,y,w,h

То есть сразу формат для Frect(), а не 4 параметра.

тоже на перспективу. Позже поиском и заменой легко можно заменить это все на новое. Только тут надо глянуть как движок эти параметры обрабатывает, и возможно ли это сделать минимумом правок.

51 Раз пошла такая пьянка, то может отдельные слоты выделим для детекторов? Дозиметр, детектор артефактов/изоморфов, все это работает с пояса. Может слоты для артефактов оставим для артефактов?) А приборы пусть ставятся в отведенное для них место, как и должно быть.
Фотоаппарат, ПНВ тоже выделить для них слоты? 

51. script_binding = bind_stalker.actor_init

Если в биндере синтаксическая ошибка, то ничего не происходит, просто объект не биндится и все. Здесь надо убрать проверку на nil и сделать чтобы ВСЕГДА вылетало, как при любой другой ошибке.

52 Подумайте, как сделать, чтобы игра могла читать нормальные видео файлы. То, что сейчас - извращение и жесть. Если получится то это позволит провести хорошую оптимизацию. Я сам собираюсь ее делать, но проблему с видео надо тоже решать. Желательно сделать так чтобы игра воспринимала формат mkv. Нужно сделать так, чтобы видеофайлы читались из папки. Тогда будет достаточно задать в скрипте имя файла и путь к нему. Именно формат MKV нужен потому что он на данный момент является самым оптимизированным. 
51. function_complete в тасках, и аналогичные ей функции - как часто они апдейтятся в движке? Можно их все сделать раз в секунду? Дело в том что по большинству тасков контролируется наличие у гг определенных предметов. Я вчера переделал полностью inventory.script сделав его синглетоном и добавил туда кеш инвентаря гг. То есть если нужно просто количество - то идет чтение из таблицы - ничего не итеритуется. А вот если нужно контролировать износ - то тут так не сделать, ибо износ меняется в процессе. Поэтому если нужен исправный предмет - то будем итерировать. И итерировать достаточно раз в секунду. Может даже раз в 2 секунды. Но 1 сек - самое то. Можно это сделать?
Я все have_item, item_much relocate_item и прочее повыкидваю и оставлю единые функции для работы с инвентарем гг:
has, got, lost.
Так что в скрипте все будет по фен-шую. В движке бы тоже также сделать)

4. Еще по инвентарю: Надо сделать нормально в движке таблицу предметов на поясе и экспортировать ее. Чтобы убрать текущие костыли с сепаратором. Пусть это будет функция db.actor:belt() параметр ид или секция. и возврат true и false. и чтобы по ней можно было итерировать при необходимости.
55. Сделать возможность включения бессмертия для гг. invulnerable(ture|false). Сейчас бессмертие сделано через спавн на пояс арта с нулевыми иммунитетами. Тоже костыль. Надо сделать по людски. И проверять можешь этот параметр там же, где защита артами считается по хиту.
56. Сделать возможность увеличения грузоподъемности артами. Добавлять значение арта к additional_inentory_weight от броников. Народ давно это просил, и это просится само по логике)
57. При лоаде не сбрасываются запущенные звуки. Продолжают играть и нужно перезапускать игру. Как пение контрика. Надо бы это пофиксить - глушить все звуки при очистке уровня перед лоадом.
58. При запуске game.start_tutorial запоминай состояние курсора и убирай его с экрана. Потом восстанавливай. level.hide_indicators нельзя использовать, ибо тогда прерывается диалог с неписем и закрывается инвентарь. а надо просто убрать курсор)
59. Вот вспомнил еще: имя игрока прописывается в реестре при установке ТЧ. Но движок при первом старте почему-то заменяет его на имя пользователя винды. Надо бы пофиксить. Чтобы именные СМС были по настоящему именными)

60. ini:r_string(section, value, default) причем, если default == nil то значение ОБЯЗАТЕЛЬНО ДОЛЖНО БЫТЬ! Иначе - вылет. Как mandatory для пысовских функций cfg_get... Даже писал скриптовую обертку, но она глючила, выкинул)
 
то есть если default == nil - просто читаем без проверок и крешимся при остутствии. Иначе - все необходимые проверки
section exists, line exists else default. 
61. И уж до кучи: перенеси в движок аналоги iterate_ini_lines. И еще надо бы добавить sections_count и r_section по номеру. Чтобы можно было перебрать все секции в файле аналогично строкам. И аналогично добавить iterate_ini_sections. По мне это необходимый минимум)

62. По нетпакету надо бы добавить контроль переполнения при записи. И вылет, если попытка записи за границы. И еще хотелось бы функцию, которая показывает, сколько осталось свободного места в непакете. Пусть это будет функция w_elapsed() - сколько еще можно записать.
